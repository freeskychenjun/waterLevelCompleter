# 水位数据恢复工具

## 功能介绍

本工具是一个专门用于恢复水位数据表中省略数值的实用应用程序。它能够自动识别并补充Excel表格中因格式原因被省略的水位数值，特别是那些只有整数部分而省略了小数部分的数值。

### 主要功能
- 自动识别和恢复省略小数位的水位数值
- 支持批量处理Excel表格中的水位数据
- 提供进度显示和处理统计
- 保持原有数据格式和结构
- 错误日志记录和异常处理

## 技术实现

### 核心算法

水位恢复的核心算法基于以下原理：

1. **完整值识别**：对于已经包含小数点和完整小数部分的数值，直接保留原值
2. **省略值恢复**：对于只包含整数部分（如"17."）的数值，根据前一天和后一天的小数部分进行合理推测
3. **空值处理**：对于空单元格，使用前后数据的平均值或合理推测值
4. **边界值检查**：确保所有恢复的数值都在合理范围内（MIN_WATER_LEVEL - MAX_WATER_LEVEL）

### 技术栈
- .NET 6.0
- Windows Forms
- EPPlus（Excel处理库）

## 使用方法

### 基本操作流程

1. **启动应用程序**：运行WaterLevelCompleter.exe
2. **打开Excel文件**：点击"打开文件"按钮，选择包含水位数据的Excel文件
3. **选择工作表**：从下拉列表中选择包含水位数据的工作表
4. **指定数据范围**：在文本框中输入需要处理的数据区域（如"A1:L31"）
5. **开始处理**：点击"开始处理"按钮启动数据恢复过程
6. **查看结果**：处理完成后，程序会自动保存处理后的文件（文件名后添加"_已恢复"）

### 数据格式要求

1. **表头格式**：第一行应为表头，包含月份信息（可以是中文或数字）
2. **日期列**：第一列应为日期（1-31）
3. **数据范围**：确保指定的数据范围内只包含需要处理的水位数值
4. **数值格式**：
   - 完整数值格式：如"11.21"（会被保留）
   - 省略格式：如"17."（会被恢复为"11.17"等）
   - 空值：会根据前后数据进行推测

## 测试功能

程序内置了测试功能，可以验证水位恢复算法的正确性：

1. **小数位省略恢复测试**
2. **完整值识别测试**
3. **空值处理测试**
4. **边界值处理测试（极大值和极小值）**

测试结果会显示在控制台窗口，并保存到程序目录下的`test_result.txt`文件中。

## 错误处理

程序具有完善的错误处理机制：

1. 文件打开错误
2. 工作表不存在
3. 数据区域无效
4. 数据格式错误
5. 数值超出合理范围

所有错误信息会在状态栏显示，并记录到错误日志中。

## 注意事项

1. **文件备份**：处理重要数据前请先备份原始文件
2. **数据格式**：确保数据格式符合要求，否则可能导致恢复结果不准确
3. **依赖项**：程序使用EPPlus库处理Excel文件，需要非商业许可证
4. **系统要求**：需要安装.NET 6.0 Runtime

## 故障排除

1. **程序启动失败**：检查是否安装了.NET 6.0 Runtime
2. **Excel文件无法打开**：确保文件未被其他程序占用，且格式兼容
3. **处理结果不准确**：检查数据范围和格式是否符合要求，特别是表头和日期列的格式
4. **错误日志**：可以点击界面上的错误日志按钮查看详细错误信息

## 更新日志

### 1.0.0
- 初始版本
- 实现基本的水位数据恢复功能
- 添加测试功能和错误处理
- 优化用户界面和性能